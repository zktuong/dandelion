Bootstrap: docker

From: ubuntu:latest

%files    
    environment_test.yml /environment.yml
    setup_mamba.sh /share/setup_mamba.sh
    dandelion_preprocess.py /share/dandelion_preprocess.py
    changeo_clonotypes.py /share/changeo_clonotypes.py
    prepare_database.py /share/prepare_database.py
    tests /tests

%post
    # Setup and install dependencies
    . /share/setup_mamba.sh
    # Download and setup reference databases
    # /opt/conda/envs/sc-dandelion-container/bin/python /share/prepare_database.py --outdir /share/database
    python /share/prepare_database.py --outdir /share/database

%environment
    export GERMLINE=/share/database/germlines/
    export IGDATA=/share/database/igblast/
    export BLASTDB=/share/database/blast/

%runscript
    alias dandelion-preprocess='/share/dandelion_preprocess.py'
    alias changeo-clonotypes='/share/changeo_clonotypes.py'
    eval ${@}

%test
    ls /share
    which blastn
    mamba list
    pytest -p no:cacheprovider /tests -W ignore::DeprecationWarning -W ignore::PendingDeprecationWarning -W ignore::FutureWarning
